#!/usr/bin/env bash
set -euo pipefail

# ?????????: hyprctl, jq, rofi (??? ?????? ?? wofi ????)

clients_json="$(hyprctl clients -j)"

# ??????: "address<TAB>class<TAB>title"
items="$(echo "$clients_json" | jq -r '.[] | select(.mapped==true) | "\(.address)\t\(.class)\t\(.title)"')"

# ???? rofi
choice="$(echo "$items" | awk -F'\t' '{printf "%s ? %s\t%s\n", $2, $3, $1}' | rofi -dmenu -i -p "Windows" || true)"
addr="$(echo "$choice" | awk -F'\t' '{print $2}')"

# ?????????? ????????? ????
if [[ -n "${addr:-}" ]]; then
  hyprctl dispatch focuswindow "address:$addr"
fi
